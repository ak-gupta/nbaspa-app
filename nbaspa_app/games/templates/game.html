{% extends 'layout.html' %}

{% from 'game_macros.html' import playerbox %}

{% block header %}
    <link
        rel="stylesheet"
        href="{{ url_for('game_bp.' + config['STATIC_FOLDER'], filename='dist/css/game.css') }}"
        type='text/css'>
{% endblock %}

{% block content %}
    <nav class="level">
        <p class="level-item has-text-centered">
            <a href="{{ url_for('teams_bp.team_summary', teamid=gameinfo['visitor_id']) }}">
                <img src="https://cdn.nba.com/logos/nba/{{ gameinfo['visitor_id'] }}/primary/L/logo.svg" width="100px">
            </a>
        </p>
        <div class="level-item has-text-centered">
            <p class="title">{{ visitortbs.PTS }}</p>
        </div>
        <div class="level-item has-text-centered">
            <p class="title">{{ hometbs.PTS }}</p>
        </div>
        <p class="level-item has-text-centered">
            <a href="{{ url_for('teams_bp.team_summary', teamid=gameinfo['home_id']) }}">
                <img src="https://cdn.nba.com/logos/nba/{{ gameinfo['home_id'] }}/primary/L/logo.svg" width="100px">
            </a>
        </p>
    </nav>
    <br>
    <h4 class="title">Top performers</h4>
    {% set tophome = homepbs[0] %}
    {% set topvisitor = visitorpbs[0] %}
    <br>
    <div class="columns">
        {% for row in [topvisitor, tophome] %}
            <div class="column">
                <div class="card">
                    <div class="card-content">
                        <div class="media">
                            <div class="media-left">
                                <a href="{{ url_for('players_bp.player_summary', playerid=row['PLAYER_ID']) }}">
                                    <img src="https://cdn.nba.com/headshots/nba/latest/260x190/{{ row['PLAYER_ID'] }}.png" height="100px">
                                </a>
                            </div>
                            <div class="media-content">
                                <p class="title is-4">{{ row['PLAYER_NAME'] }}</p>
                                <nav class="level is-mobile">
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">SPA</p>
                                            <p class="title">{{ row['IMPACT'] }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">Points</p>
                                            <p class="title">{{ row['PTS']|int }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">Assists</p>
                                            <p class="title">{{ row['AST']|int }}</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">Rebounds</p>
                                            <p class="title">{{ row['REB']|int }}</p>
                                        </div>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    <br>
    <h4 class="title">Win probability over game time</h4>
    <div id="gameGraph" style="text-align: center;"></div>
    <br>
    <h4 class="title">Team boxscore</h4>
    <table class="table has-background-light">
        <thead>
            <tr>
                <th></th>
                <th><abbr title="Field Goals">FG</abbr></th>
                <th><abbr title="3 Pointers">FG3</abbr></th>
                <th><abbr title="Free Throws">FT</abbr></th>
                <th><abbr title="Rebounds (Off/Def)">Reb</abbr></th>
                <th><abbr title="Assists">Ast</abbr></th>
                <th><abbr title="Steals">Stl</abbr></th>
                <th><abbr title="Blocks">Blk</abbr></th>
                <th><abbr title="Turnovers">TO</abbr></th>
            </tr>
        </thead>
        <tbody>
            {% for row in [visitortbs, hometbs] %}
                <tr>
                    <td>
                        <img src="https://cdn.nba.com/logos/nba/{{ row['TEAM_ID'] }}/primary/L/logo.svg" width="50px">
                    </td>
                    <td>{{ row['FG_PCT'] }}% ({{ row['FGM'] }}/{{ row['FGA'] }})</td>
                    <td>{{ row['FG3_PCT'] }}% ({{ row['FG3M'] }}/{{ row['FG3A'] }})</td>
                    <td>{{ row['FT_PCT'] }}% ({{ row['FTM'] }}/{{ row['FTA'] }})</td>
                    <td>{{ row['REB'] }} ({{ row['OREB'] }}/{{ row['DREB'] }})</td>
                    <td>{{ row['AST'] }}</td>
                    <td>{{ row['STL'] }}</td>
                    <td>{{ row['BLK'] }}</td>
                    <td>{{ row['TO'] }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    <h4 class="title">Player boxscore</h4>
    <br>
    <div class="tabs is-centered is-large">
        <ul>
            <li class="tablinks" id="defaultTab" onclick="openBox(event, 'visitorPlayerBox')"><a>{{ gameinfo['visitor_abbrev'] }}</a></li>
            <li class="tablinks" onclick="openBox(event, 'homePlayerBox')"><a>{{ gameinfo['home_abbrev'] }}</a></li>
        </ul>
    </div>

    <div id="homePlayerBox" class="tabcontent">
        {{ playerbox(box=homepbs) }}
    </div>
    <div id="visitorPlayerBox" class="tabcontent">
        {{ playerbox(box=visitorpbs) }}
    </div>
{% endblock %}

{% block jsScript %}
    <script type="text/javascript" src="{{ url_for('game_bp.' + config['STATIC_FOLDER'], filename='dist/js/game-graph.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('game_bp.' + config['STATIC_FOLDER'], filename='dist/js/game-tabs.js') }}"></script>
    <script>
        var lineData = {{ line_chart_data|safe }}
        var dotData = {{ point_chart_data|safe }}
        drawGameChart(lineData, dotData, tag="#gameGraph")
        document.getElementById("defaultTab").click()
    </script>
{% endblock %}
